<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/f25260a5bd2b21c3.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-879f858537244e02.js"/><script src="/_next/static/chunks/fd9d1056-2821b0f0cabcd8bd.js" async=""></script><script src="/_next/static/chunks/23-fcd997dff58d4f95.js" async=""></script><script src="/_next/static/chunks/main-app-ed9f027efa6787fc.js" async=""></script><script src="/_next/static/chunks/231-bea070b1ecddfbbc.js" async=""></script><script src="/_next/static/chunks/app/docs/layout-b24984ce47656698.js" async=""></script><title>MCPVals Docs</title><meta name="description" content="Documentation for MCPVals"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="min-h-screen bg-white text-zinc-900 antialiased dark:bg-zinc-950 dark:text-zinc-100"><div class="flex"><aside class="w-64 shrink-0 border-r border-zinc-200/60 dark:border-zinc-800/60 p-4 sticky top-0 h-screen overflow-y-auto"><div class="text-lg font-semibold mb-4">MCPVals Docs</div><nav class="space-y-1"><a class="block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900" href="/docs/index">Core Concepts</a><a class="block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900" href="/docs/acknowledgements">Acknowledgements</a><a class="block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900" href="/docs/cli">CLI Reference</a><a class="block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900" href="/docs/configuration">Configuration</a><a class="block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900" href="/docs/evaluation">Evaluation &amp; Metrics</a><a class="block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900" href="/docs/installation">Installation &amp; Runtime Requirements</a><a class="block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900" href="/docs/library-api">Library API</a><a class="block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900" href="/docs/quick-start">Quick Start</a><a class="block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900" href="/docs/roadmap">Roadmap</a><a class="block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900" href="/docs/vitest">Vitest Integration</a></nav></aside><main class="flex-1 p-6"><article class="prose prose-zinc max-w-none dark:prose-invert"><h1 id="vitest-integration"><a href="#vitest-integration">Vitest Integration</a></h1>
<p>MCPVals provides a complete <strong>Vitest integration</strong> for writing MCP server tests using the popular Vitest testing framework. This integration offers both individual test utilities and comprehensive evaluation suites with built-in scoring and custom matchers.</p>
<h3 id="71-quick-start"><a href="#71-quick-start">7.1 Quick Start</a></h3>
<pre><code class="language-bash"># Install vitest alongside mcpvals
pnpm add -D mcpvals vitest
</code></pre>
<pre><code class="language-typescript">// tests/calculator.test.ts
import { describe, it, expect, beforeAll, afterAll } from &quot;vitest&quot;;
import {
  setupMCPServer,
  teardownMCPServer,
  mcpTest,
  describeEval,
  ToolCallScorer,
  LatencyScorer,
  ContentScorer,
} from &quot;mcpvals&quot;;

describe(&quot;Calculator MCP Server&quot;, () =&gt; {
  beforeAll(async () =&gt; {
    await setupMCPServer({
      transport: &quot;stdio&quot;,
      command: &quot;node&quot;,
      args: [&quot;./calculator-server.js&quot;],
    });
  });

  afterAll(async () =&gt; {
    await teardownMCPServer();
  });

  // Individual test
  mcpTest(&quot;should add numbers&quot;, async (utils) =&gt; {
    const result = await utils.callTool(&quot;add&quot;, { a: 5, b: 3 });
    expect(result.content[0].text).toBe(&quot;8&quot;);

    // Custom matchers
    await expect(result).toCallTool(&quot;add&quot;);
    await expect(result).toHaveLatencyBelow(1000);
  });
});
</code></pre>
<h3 id="72-core-functions"><a href="#72-core-functions">7.2 Core Functions</a></h3>
<h4 id="setupmcpserverconfig-options"><a href="#setupmcpserverconfig-options"><strong><code>setupMCPServer(config, options?)</code></strong></a></h4>
<p>Starts an MCP server and returns utilities for testing.</p>
<pre><code class="language-typescript">const utils = await setupMCPServer(
  {
    transport: &quot;stdio&quot;,
    command: &quot;node&quot;,
    args: [&quot;./server.js&quot;],
  },
  {
    timeout: 30000, // Server startup timeout
    debug: false, // Enable debug logging
  },
);

// Returns utility functions:
utils.callTool(name, args); // Call MCP tools
utils.runWorkflow(steps); // Execute LLM workflows
utils.listResources(); // Get available resources
utils.getResource(uri); // Read resource content
utils.listPrompts(); // Get available prompts
utils.getPrompt(name, args); // Execute prompts
</code></pre>
<h4 id="teardownmcpserver"><a href="#teardownmcpserver"><strong><code>teardownMCPServer()</code></strong></a></h4>
<p>Cleanly shuts down the MCP server (call in <code>afterAll</code>).</p>
<h4 id="mcptestname-testfn-timeout"><a href="#mcptestname-testfn-timeout"><strong><code>mcpTest(name, testFn, timeout?)</code></strong></a></h4>
<p>Convenient wrapper for individual MCP tests.</p>
<pre><code class="language-typescript">mcpTest(
  &quot;tool test&quot;,
  async (utils) =&gt; {
    const result = await utils.callTool(&quot;echo&quot;, { message: &quot;hello&quot; });
    expect(result).toBeDefined();
  },
  10000,
); // Optional timeout
</code></pre>
<h4 id="describeevalconfig"><a href="#describeevalconfig"><strong><code>describeEval(config)</code></strong></a></h4>
<p>Comprehensive evaluation suite with automated scoring.</p>
<pre><code class="language-typescript">describeEval({
  name: &quot;Calculator Evaluation&quot;,
  server: { transport: &quot;stdio&quot;, command: &quot;node&quot;, args: [&quot;./calc.js&quot;] },
  threshold: 0.8, // 80% score required to pass

  data: async () =&gt; [
    {
      input: { operation: &quot;add&quot;, a: 5, b: 3 },
      expected: { result: &quot;8&quot;, tools: [&quot;add&quot;] },
    },
  ],

  task: async (input, context) =&gt; {
    const result = await context.utils.callTool(input.operation, {
      a: input.a,
      b: input.b,
    });
    return {
      result: result.content[0].text,
      toolCalls: [{ name: input.operation }],
      latency: Date.now() - startTime,
    };
  },

  scorers: [
    new ToolCallScorer({ expectedOrder: true }),
    new LatencyScorer({ maxLatencyMs: 1000 }),
    new ContentScorer({ patterns: [/\d+/] }),
  ],
});
</code></pre>
<h3 id="73-built-in-scorers"><a href="#73-built-in-scorers">7.3 Built-in Scorers</a></h3>
<p>Scorers automatically evaluate different aspects of MCP server behavior, returning scores from 0-1.</p>
<h4 id="toolcallscorer---tool-usage-evaluation"><a href="#toolcallscorer---tool-usage-evaluation"><strong><code>ToolCallScorer</code></strong> - Tool Usage Evaluation</a></h4>
<pre><code class="language-typescript">new ToolCallScorer({
  expectedTools: [&quot;add&quot;, &quot;multiply&quot;], // Tools that should be called
  expectedOrder: true, // Whether order matters
  allowExtraTools: false, // Penalize unexpected tools
});
</code></pre>
<p><strong>Scoring Algorithm:</strong></p>
<ul>
<li>70% for calling expected tools</li>
<li>20% for correct order (if enabled)</li>
<li>10% penalty for extra tools (if disabled)</li>
</ul>
<h4 id="latencyscorer---performance-evaluation"><a href="#latencyscorer---performance-evaluation"><strong><code>LatencyScorer</code></strong> - Performance Evaluation</a></h4>
<pre><code class="language-typescript">new LatencyScorer({
  maxLatencyMs: 1000, // Maximum acceptable latency
  penaltyThreshold: 500, // Start penalizing after this
});
</code></pre>
<p><strong>Scoring Logic:</strong></p>
<ul>
<li>Perfect score (1.0) for latency ≤ threshold</li>
<li>Linear penalty between threshold and max</li>
<li>Severe penalty (0.1) for exceeding max</li>
<li>Perfect score for 0ms latency</li>
</ul>
<h4 id="workflowscorer---workflow-success-evaluation"><a href="#workflowscorer---workflow-success-evaluation"><strong><code>WorkflowScorer</code></strong> - Workflow Success Evaluation</a></h4>
<pre><code class="language-typescript">new WorkflowScorer({
  requireSuccess: true, // Must have success: true
  checkMessages: true, // Validate message structure
  minMessages: 2, // Minimum message count
});
</code></pre>
<h4 id="contentscorer---output-quality-assessment"><a href="#contentscorer---output-quality-assessment"><strong><code>ContentScorer</code></strong> - Output Quality Assessment</a></h4>
<pre><code class="language-typescript">new ContentScorer({
  exactMatch: false, // Exact content matching
  caseSensitive: false, // Case sensitivity
  patterns: [/\d+/, /success/], // RegExp patterns to match
  requiredKeywords: [&quot;result&quot;], // Must contain these
  forbiddenKeywords: [&quot;error&quot;, &quot;fail&quot;], // Penalize these
});
</code></pre>
<p><strong>Multi-dimensional Scoring:</strong></p>
<ul>
<li>40% pattern matching</li>
<li>40% required keywords</li>
<li>-20% forbidden keywords penalty</li>
<li>20% content relevance</li>
</ul>
<h3 id="74-custom-matchers"><a href="#74-custom-matchers">7.4 Custom Matchers</a></h3>
<p>MCPVals extends Vitest with MCP-specific assertion matchers:</p>
<pre><code class="language-typescript">// Tool call assertions
await expect(result).toCallTool(&quot;add&quot;);
await expect(result).toCallTools([&quot;add&quot;, &quot;multiply&quot;]);
await expect(result).toHaveToolCallOrder([&quot;add&quot;, &quot;multiply&quot;]);

// Workflow assertions
await expect(workflow).toHaveSuccessfulWorkflow();

// Performance assertions
await expect(result).toHaveLatencyBelow(1000);

// Content assertions
await expect(result).toContainKeywords([&quot;success&quot;, &quot;complete&quot;]);
await expect(result).toMatchPattern(/result: \d+/);
</code></pre>
<p><strong>Smart Content Extraction</strong>: Matchers automatically handle various output formats:</p>
<ul>
<li>MCP server responses (<code>content[0].text</code>)</li>
<li>Custom result objects (<code>{ result, toolCalls, latency }</code>)</li>
<li>String outputs</li>
<li>Workflow results (<code>{ success, messages, toolCalls }</code>)</li>
</ul>
<h3 id="75-typescript-support"><a href="#75-typescript-support">7.5 TypeScript Support</a></h3>
<p>Complete type safety with concrete types for common use cases:</p>
<pre><code class="language-typescript">import type {
  MCPTestConfig,
  MCPTestContext,
  ToolCallTestCase,
  MCPToolResult,
  MCPWorkflowResult,
  ToolCallScorerOptions,
  LatencyScorerOptions,
  ContentScorerOptions,
  WorkflowScorerOptions,
} from &quot;mcpvals&quot;;

// Typed test case
const testCase: ToolCallTestCase = {
  input: { operation: &quot;add&quot;, a: 5, b: 3 },
  expected: { result: &quot;8&quot;, tools: [&quot;add&quot;] },
};

// Typed scorer options
const scorer = new ToolCallScorer({
  expectedOrder: true,
  allowExtraTools: false,
} satisfies ToolCallScorerOptions);

// Typed task function
task: async (input, context): Promise&lt;MCPToolResult&gt; =&gt; {
  const testCase = input as ToolCallTestCase[&quot;input&quot;];
  const result = await context.utils.callTool(testCase.operation, {
    a: testCase.a,
    b: testCase.b,
  });
  return {
    result: result.content[0].text,
    toolCalls: [{ name: testCase.operation }],
    success: true,
    latency: Date.now() - startTime,
  };
};
</code></pre>
<h3 id="76-advanced-usage"><a href="#76-advanced-usage">7.6 Advanced Usage</a></h3>
<h4 id="dynamic-test-generation"><a href="#dynamic-test-generation"><strong>Dynamic Test Generation</strong></a></h4>
<pre><code class="language-typescript">describeEval({
  name: &quot;Dynamic Calculator Tests&quot;,
  data: async () =&gt; {
    const operations = [&quot;add&quot;, &quot;subtract&quot;, &quot;multiply&quot;, &quot;divide&quot;];
    return operations.map((op) =&gt; ({
      name: `Test ${op}`,
      input: { operation: op, a: 10, b: 2 },
      expected: { tools: [op] },
    }));
  },
});
</code></pre>
<h4 id="context-aware-testing"><a href="#context-aware-testing"><strong>Context-Aware Testing</strong></a></h4>
<pre><code class="language-typescript">task: async (input, context) =&gt; {
  console.log(
    &quot;Available tools:&quot;,
    context.tools.map((t) =&gt; t.name),
  );
  console.log(&quot;Running:&quot;, context.testCase.name);

  const resources = await context.utils.listResources();
  const prompts = await context.utils.listPrompts();

  return await context.utils.callTool(&quot;process&quot;, {
    ...input,
    resources,
    prompts,
  });
};
</code></pre>
<h4 id="debug-mode"><a href="#debug-mode"><strong>Debug Mode</strong></a></h4>
<pre><code class="language-bash"># Enable detailed logging
VITEST_MCP_DEBUG=true vitest run

# Shows:
# - Individual test scores and explanations
# - Performance metrics
# - Pass/fail reasons
# - Server lifecycle events
</code></pre>
<h3 id="77-integration-patterns"><a href="#77-integration-patterns">7.7 Integration Patterns</a></h3>
<h4 id="unit-testing-individual-tools"><a href="#unit-testing-individual-tools"><strong>Unit Testing Individual Tools</strong></a></h4>
<pre><code class="language-typescript">describe(&quot;Individual Tool Tests&quot;, () =&gt; {
  beforeAll(() =&gt; setupMCPServer(config));
  afterAll(() =&gt; teardownMCPServer());

  mcpTest(&quot;calculator addition&quot;, async (utils) =&gt; {
    const result = await utils.callTool(&quot;add&quot;, { a: 2, b: 3 });
    expect(result.content[0].text).toBe(&quot;5&quot;);
  });

  mcpTest(&quot;error handling&quot;, async (utils) =&gt; {
    try {
      await utils.callTool(&quot;divide&quot;, { a: 10, b: 0 });
      throw new Error(&quot;Should have failed&quot;);
    } catch (error) {
      expect(error.message).toContain(&quot;division by zero&quot;);
    }
  });
});
</code></pre>
<h4 id="integration-testing-with-workflows"><a href="#integration-testing-with-workflows"><strong>Integration Testing with Workflows</strong></a></h4>
<pre><code class="language-typescript">mcpTest(&quot;complex workflow&quot;, async (utils) =&gt; {
  const workflow = await utils.runWorkflow([
    {
      user: &quot;Calculate 2+3 then multiply by 4&quot;,
      expectTools: [&quot;add&quot;, &quot;multiply&quot;],
    },
  ]);

  await expect(workflow).toHaveSuccessfulWorkflow();
  await expect(workflow).toCallTools([&quot;add&quot;, &quot;multiply&quot;]);
  expect(workflow.messages).toHaveLength(2);
});
</code></pre>
<h4 id="performance-benchmarking"><a href="#performance-benchmarking"><strong>Performance Benchmarking</strong></a></h4>
<pre><code class="language-typescript">describeEval({
  name: &quot;Performance Benchmarks&quot;,
  threshold: 0.9, // High threshold for performance tests
  scorers: [
    new LatencyScorer({
      maxLatencyMs: 100, // Strict latency requirement
      penaltyThreshold: 50,
    }),
    new ToolCallScorer({ allowExtraTools: false }), // No unnecessary calls
    new ContentScorer({ patterns: [/^\d+$/] }), // Validate output format
  ],
});
</code></pre>
<h4 id="multi-server-testing"><a href="#multi-server-testing"><strong>Multi-Server Testing</strong></a></h4>
<pre><code class="language-typescript">describe(&quot;Multi-Server Comparison&quot;, () =&gt; {
  const servers = [
    { name: &quot;Server A&quot;, command: &quot;./server-a.js&quot; },
    { name: &quot;Server B&quot;, command: &quot;./server-b.js&quot; },
  ];

  servers.forEach((server) =&gt; {
    describe(server.name, () =&gt; {
      beforeAll(() =&gt;
        setupMCPServer({
          transport: &quot;stdio&quot;,
          command: &quot;node&quot;,
          args: [server.command],
        }),
      );
      afterAll(() =&gt; teardownMCPServer());

      mcpTest(&quot;standard test&quot;, async (utils) =&gt; {
        const result = await utils.callTool(&quot;test&quot;, {});
        expect(result).toBeDefined();
      });
    });
  });
});
</code></pre>
<h3 id="78-best-practices"><a href="#78-best-practices">7.8 Best Practices</a></h3>
<ol>
<li><strong>Use <code>beforeAll</code>/<code>afterAll</code></strong>: Always properly setup and teardown MCP servers</li>
<li><strong>Leverage TypeScript</strong>: Use concrete types for better development experience</li>
<li><strong>Test individual tools first</strong>: Use <code>mcpTest</code> for unit testing, <code>describeEval</code> for integration</li>
<li><strong>Set appropriate thresholds</strong>: Start with 0.8, adjust based on your quality requirements</li>
<li><strong>Combine scorers</strong>: Use multiple scorers to evaluate different aspects (functionality, performance, content)</li>
<li><strong>Enable debug mode</strong>: Use <code>VITEST_MCP_DEBUG=true</code> when troubleshooting</li>
<li><strong>Write realistic test data</strong>: Create test cases that reflect real-world usage</li>
<li><strong>Use custom matchers</strong>: Leverage MCP-specific matchers for readable assertions</li>
</ol>
<h3 id="79-example-complete-test-suite"><a href="#79-example-complete-test-suite">7.9 Example: Complete Test Suite</a></h3>
<pre><code class="language-typescript">import { describe, it, expect, beforeAll, afterAll } from &quot;vitest&quot;;
import {
  setupMCPServer,
  teardownMCPServer,
  mcpTest,
  describeEval,
  ToolCallScorer,
  WorkflowScorer,
  LatencyScorer,
  ContentScorer,
  type ToolCallTestCase,
  type MCPToolResult,
} from &quot;mcpvals&quot;;

describe(&quot;Production Calculator Server&quot;, () =&gt; {
  beforeAll(async () =&gt; {
    await setupMCPServer(
      {
        transport: &quot;stdio&quot;,
        command: &quot;node&quot;,
        args: [&quot;./dist/calculator-server.js&quot;],
      },
      {
        timeout: 10000,
        debug: process.env.CI !== &quot;true&quot;,
      },
    );
  });

  afterAll(async () =&gt; {
    await teardownMCPServer();
  });

  // Unit tests for individual operations
  mcpTest(&quot;addition works correctly&quot;, async (utils) =&gt; {
    const result = await utils.callTool(&quot;add&quot;, { a: 5, b: 3 });
    expect(result.content[0].text).toBe(&quot;8&quot;);
    await expect(result).toCallTool(&quot;add&quot;);
    await expect(result).toHaveLatencyBelow(100);
  });

  mcpTest(&quot;handles division by zero&quot;, async (utils) =&gt; {
    try {
      await utils.callTool(&quot;divide&quot;, { a: 10, b: 0 });
      throw new Error(&quot;Expected division by zero error&quot;);
    } catch (error) {
      expect(error.message).toContain(&quot;division by zero&quot;);
    }
  });

  // Comprehensive evaluation suite
  describeEval({
    name: &quot;Calculator Performance Suite&quot;,
    server: {
      transport: &quot;stdio&quot;,
      command: &quot;node&quot;,
      args: [&quot;./dist/calculator-server.js&quot;],
    },
    threshold: 0.85,
    timeout: 30000,

    data: async (): Promise&lt;ToolCallTestCase[]&gt; =&gt; [
      {
        name: &quot;Basic Addition&quot;,
        input: { operation: &quot;add&quot;, a: 10, b: 5 },
        expected: { result: &quot;15&quot;, tools: [&quot;add&quot;] },
      },
      {
        name: &quot;Complex Multiplication&quot;,
        input: { operation: &quot;multiply&quot;, a: 7, b: 8 },
        expected: { result: &quot;56&quot;, tools: [&quot;multiply&quot;] },
      },
      {
        name: &quot;Subtraction Test&quot;,
        input: { operation: &quot;subtract&quot;, a: 20, b: 8 },
        expected: { result: &quot;12&quot;, tools: [&quot;subtract&quot;] },
      },
    ],

    task: async (input, context): Promise&lt;MCPToolResult&gt; =&gt; {
      const testCase = input as ToolCallTestCase[&quot;input&quot;];
      const startTime = Date.now();

      try {
        const result = await context.utils.callTool(testCase.operation, {
          a: testCase.a,
          b: testCase.b,
        });

        return {
          result: result.content[0].text,
          toolCalls: [{ name: testCase.operation }],
          success: true,
          latency: Date.now() - startTime,
          executionTime: Date.now() - startTime,
        };
      } catch (error) {
        return {
          result: null,
          toolCalls: [],
          success: false,
          error: error.message,
          latency: Date.now() - startTime,
          executionTime: Date.now() - startTime,
        };
      }
    },

    scorers: [
      new ToolCallScorer({
        expectedOrder: true,
        allowExtraTools: false,
      }),
      new WorkflowScorer({
        requireSuccess: true,
        checkMessages: false,
      }),
      new LatencyScorer({
        maxLatencyMs: 500,
        penaltyThreshold: 200,
      }),
      new ContentScorer({
        exactMatch: false,
        caseSensitive: false,
        patterns: [/^\d+$/], // Results should be numbers
      }),
    ],
  });

  // Integration test with workflows
  mcpTest(&quot;multi-step calculation workflow&quot;, async (utils) =&gt; {
    const workflow = await utils.runWorkflow([
      {
        user: &quot;Calculate 5 plus 3, then multiply the result by 2&quot;,
        expectTools: [&quot;add&quot;, &quot;multiply&quot;],
      },
    ]);

    await expect(workflow).toHaveSuccessfulWorkflow();
    await expect(workflow).toCallTools([&quot;add&quot;, &quot;multiply&quot;]);
    await expect(workflow).toHaveToolCallOrder([&quot;add&quot;, &quot;multiply&quot;]);

    // Verify final result
    const finalMessage = workflow.messages[workflow.messages.length - 1];
    expect(finalMessage.content).toContain(&quot;16&quot;);
  });
});
</code></pre>
<p><strong>Run the tests:</strong></p>
<pre><code class="language-bash"># Run all tests
vitest run

# Run with debug output
VITEST_MCP_DEBUG=true vitest run

# Run in watch mode during development
vitest

# Generate coverage report
vitest run --coverage
</code></pre>
<p>This Vitest integration makes MCP server testing <strong>accessible, automated, and reliable</strong> - combining the speed and developer experience of Vitest with specialized tools for comprehensive MCP server evaluation.</p>
<hr/></article></main></div><script src="/_next/static/chunks/webpack-879f858537244e02.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/f25260a5bd2b21c3.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[5751,[],\"\"]\n5:I[9275,[],\"\"]\n7:I[1343,[],\"\"]\n8:I[231,[\"231\",\"static/chunks/231-bea070b1ecddfbbc.js\",\"998\",\"static/chunks/app/docs/layout-b24984ce47656698.js\"],\"\"]\na:I[6130,[],\"\"]\n4:Tf6d,"])</script><script>self.__next_f.push([1,"import { describe, it, expect, beforeAll, afterAll } from \"vitest\";\nimport {\n  setupMCPServer,\n  teardownMCPServer,\n  mcpTest,\n  describeEval,\n  ToolCallScorer,\n  WorkflowScorer,\n  LatencyScorer,\n  ContentScorer,\n  type ToolCallTestCase,\n  type MCPToolResult,\n} from \"mcpvals\";\n\ndescribe(\"Production Calculator Server\", () =\u003e {\n  beforeAll(async () =\u003e {\n    await setupMCPServer(\n      {\n        transport: \"stdio\",\n        command: \"node\",\n        args: [\"./dist/calculator-server.js\"],\n      },\n      {\n        timeout: 10000,\n        debug: process.env.CI !== \"true\",\n      },\n    );\n  });\n\n  afterAll(async () =\u003e {\n    await teardownMCPServer();\n  });\n\n  // Unit tests for individual operations\n  mcpTest(\"addition works correctly\", async (utils) =\u003e {\n    const result = await utils.callTool(\"add\", { a: 5, b: 3 });\n    expect(result.content[0].text).toBe(\"8\");\n    await expect(result).toCallTool(\"add\");\n    await expect(result).toHaveLatencyBelow(100);\n  });\n\n  mcpTest(\"handles division by zero\", async (utils) =\u003e {\n    try {\n      await utils.callTool(\"divide\", { a: 10, b: 0 });\n      throw new Error(\"Expected division by zero error\");\n    } catch (error) {\n      expect(error.message).toContain(\"division by zero\");\n    }\n  });\n\n  // Comprehensive evaluation suite\n  describeEval({\n    name: \"Calculator Performance Suite\",\n    server: {\n      transport: \"stdio\",\n      command: \"node\",\n      args: [\"./dist/calculator-server.js\"],\n    },\n    threshold: 0.85,\n    timeout: 30000,\n\n    data: async (): Promise\u003cToolCallTestCase[]\u003e =\u003e [\n      {\n        name: \"Basic Addition\",\n        input: { operation: \"add\", a: 10, b: 5 },\n        expected: { result: \"15\", tools: [\"add\"] },\n      },\n      {\n        name: \"Complex Multiplication\",\n        input: { operation: \"multiply\", a: 7, b: 8 },\n        expected: { result: \"56\", tools: [\"multiply\"] },\n      },\n      {\n        name: \"Subtraction Test\",\n        input: { operation: \"subtract\", a: 20, b: 8 },\n        expected: { result: \"12\", tools: [\"subtract\"] },\n      },\n    ],\n\n    task: async (input, context): Promise\u003cMCPToolResult\u003e =\u003e {\n      const testCase = input as ToolCallTestCase[\"input\"];\n      const startTime = Date.now();\n\n      try {\n        const result = await context.utils.callTool(testCase.operation, {\n          a: testCase.a,\n          b: testCase.b,\n        });\n\n        return {\n          result: result.content[0].text,\n          toolCalls: [{ name: testCase.operation }],\n          success: true,\n          latency: Date.now() - startTime,\n          executionTime: Date.now() - startTime,\n        };\n      } catch (error) {\n        return {\n          result: null,\n          toolCalls: [],\n          success: false,\n          error: error.message,\n          latency: Date.now() - startTime,\n          executionTime: Date.now() - startTime,\n        };\n      }\n    },\n\n    scorers: [\n      new ToolCallScorer({\n        expectedOrder: true,\n        allowExtraTools: false,\n      }),\n      new WorkflowScorer({\n        requireSuccess: true,\n        checkMessages: false,\n      }),\n      new LatencyScorer({\n        maxLatencyMs: 500,\n        penaltyThreshold: 200,\n      }),\n      new ContentScorer({\n        exactMatch: false,\n        caseSensitive: false,\n        patterns: [/^\\d+$/], // Results should be numbers\n      }),\n    ],\n  });\n\n  // Integration test with workflows\n  mcpTest(\"multi-step calculation workflow\", async (utils) =\u003e {\n    const workflow = await utils.runWorkflow([\n      {\n        user: \"Calculate 5 plus 3, then multiply the result by 2\",\n        expectTools: [\"add\", \"multiply\"],\n      },\n    ]);\n\n    await expect(workflow).toHaveSuccessfulWorkflow();\n    await expect(workflow).toCallTools([\"add\", \"multiply\"]);\n    await expect(workflow).toHaveToolCallOrder([\"add\", \"multiply\"]);\n\n    // Verify final result\n    const finalMessage = workflow.messages[workflow.messages.length - 1];\n    expect(finalMessage.content).toContain(\"16\");\n  });\n});\n"])</script><script>self.__next_f.push([1,"6:[\"slug\",\"vitest\",\"c\"]\nb:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L2\",null,{\"buildId\":\"mtG3UlcSqFkfpBd0gWDhs\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"docs\",\"vitest\"],\"initialTree\":[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"vitest\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"vitest\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"vitest\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",[\"$\",\"article\",null,{\"className\":\"prose prose-zinc max-w-none dark:prose-invert\",\"children\":[[\"$\",\"h1\",\"h1-0\",{\"id\":\"vitest-integration\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#vitest-integration\",\"children\":\"Vitest Integration\"}]}],\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[\"MCPVals provides a complete \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"Vitest integration\"}],\" for writing MCP server tests using the popular Vitest testing framework. This integration offers both individual test utilities and comprehensive evaluation suites with built-in scoring and custom matchers.\"]}],\"\\n\",[\"$\",\"h3\",\"h3-0\",{\"id\":\"71-quick-start\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#71-quick-start\",\"children\":\"7.1 Quick Start\"}]}],\"\\n\",[\"$\",\"pre\",\"pre-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-bash\",\"children\":\"# Install vitest alongside mcpvals\\npnpm add -D mcpvals vitest\\n\"}]}],\"\\n\",[\"$\",\"pre\",\"pre-1\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"// tests/calculator.test.ts\\nimport { describe, it, expect, beforeAll, afterAll } from \\\"vitest\\\";\\nimport {\\n  setupMCPServer,\\n  teardownMCPServer,\\n  mcpTest,\\n  describeEval,\\n  ToolCallScorer,\\n  LatencyScorer,\\n  ContentScorer,\\n} from \\\"mcpvals\\\";\\n\\ndescribe(\\\"Calculator MCP Server\\\", () =\u003e {\\n  beforeAll(async () =\u003e {\\n    await setupMCPServer({\\n      transport: \\\"stdio\\\",\\n      command: \\\"node\\\",\\n      args: [\\\"./calculator-server.js\\\"],\\n    });\\n  });\\n\\n  afterAll(async () =\u003e {\\n    await teardownMCPServer();\\n  });\\n\\n  // Individual test\\n  mcpTest(\\\"should add numbers\\\", async (utils) =\u003e {\\n    const result = await utils.callTool(\\\"add\\\", { a: 5, b: 3 });\\n    expect(result.content[0].text).toBe(\\\"8\\\");\\n\\n    // Custom matchers\\n    await expect(result).toCallTool(\\\"add\\\");\\n    await expect(result).toHaveLatencyBelow(1000);\\n  });\\n});\\n\"}]}],\"\\n\",[\"$\",\"h3\",\"h3-1\",{\"id\":\"72-core-functions\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#72-core-functions\",\"children\":\"7.2 Core Functions\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-0\",{\"id\":\"setupmcpserverconfig-options\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#setupmcpserverconfig-options\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"setupMCPServer(config, options?)\"}]}]}]}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":\"Starts an MCP server and returns utilities for testing.\"}],\"\\n\",[\"$\",\"pre\",\"pre-2\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"const utils = await setupMCPServer(\\n  {\\n    transport: \\\"stdio\\\",\\n    command: \\\"node\\\",\\n    args: [\\\"./server.js\\\"],\\n  },\\n  {\\n    timeout: 30000, // Server startup timeout\\n    debug: false, // Enable debug logging\\n  },\\n);\\n\\n// Returns utility functions:\\nutils.callTool(name, args); // Call MCP tools\\nutils.runWorkflow(steps); // Execute LLM workflows\\nutils.listResources(); // Get available resources\\nutils.getResource(uri); // Read resource content\\nutils.listPrompts(); // Get available prompts\\nutils.getPrompt(name, args); // Execute prompts\\n\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-1\",{\"id\":\"teardownmcpserver\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#teardownmcpserver\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"teardownMCPServer()\"}]}]}]}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":[\"Cleanly shuts down the MCP server (call in \",[\"$\",\"code\",\"code-0\",{\"children\":\"afterAll\"}],\").\"]}],\"\\n\",[\"$\",\"h4\",\"h4-2\",{\"id\":\"mcptestname-testfn-timeout\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#mcptestname-testfn-timeout\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"mcpTest(name, testFn, timeout?)\"}]}]}]}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":\"Convenient wrapper for individual MCP tests.\"}],\"\\n\",[\"$\",\"pre\",\"pre-3\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"mcpTest(\\n  \\\"tool test\\\",\\n  async (utils) =\u003e {\\n    const result = await utils.callTool(\\\"echo\\\", { message: \\\"hello\\\" });\\n    expect(result).toBeDefined();\\n  },\\n  10000,\\n); // Optional timeout\\n\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-3\",{\"id\":\"describeevalconfig\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#describeevalconfig\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"describeEval(config)\"}]}]}]}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":\"Comprehensive evaluation suite with automated scoring.\"}],\"\\n\",[\"$\",\"pre\",\"pre-4\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"describeEval({\\n  name: \\\"Calculator Evaluation\\\",\\n  server: { transport: \\\"stdio\\\", command: \\\"node\\\", args: [\\\"./calc.js\\\"] },\\n  threshold: 0.8, // 80% score required to pass\\n\\n  data: async () =\u003e [\\n    {\\n      input: { operation: \\\"add\\\", a: 5, b: 3 },\\n      expected: { result: \\\"8\\\", tools: [\\\"add\\\"] },\\n    },\\n  ],\\n\\n  task: async (input, context) =\u003e {\\n    const result = await context.utils.callTool(input.operation, {\\n      a: input.a,\\n      b: input.b,\\n    });\\n    return {\\n      result: result.content[0].text,\\n      toolCalls: [{ name: input.operation }],\\n      latency: Date.now() - startTime,\\n    };\\n  },\\n\\n  scorers: [\\n    new ToolCallScorer({ expectedOrder: true }),\\n    new LatencyScorer({ maxLatencyMs: 1000 }),\\n    new ContentScorer({ patterns: [/\\\\d+/] }),\\n  ],\\n});\\n\"}]}],\"\\n\",[\"$\",\"h3\",\"h3-2\",{\"id\":\"73-built-in-scorers\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#73-built-in-scorers\",\"children\":\"7.3 Built-in Scorers\"}]}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"children\":\"Scorers automatically evaluate different aspects of MCP server behavior, returning scores from 0-1.\"}],\"\\n\",[\"$\",\"h4\",\"h4-4\",{\"id\":\"toolcallscorer---tool-usage-evaluation\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#toolcallscorer---tool-usage-evaluation\",\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"ToolCallScorer\"}]}],\" - Tool Usage Evaluation\"]}]}],\"\\n\",[\"$\",\"pre\",\"pre-5\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"new ToolCallScorer({\\n  expectedTools: [\\\"add\\\", \\\"multiply\\\"], // Tools that should be called\\n  expectedOrder: true, // Whether order matters\\n  allowExtraTools: false, // Penalize unexpected tools\\n});\\n\"}]}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Scoring Algorithm:\"}]}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"70% for calling expected tools\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"20% for correct order (if enabled)\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"10% penalty for extra tools (if disabled)\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h4\",\"h4-5\",{\"id\":\"latencyscorer---performance-evaluation\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#latencyscorer---performance-evaluation\",\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"LatencyScorer\"}]}],\" - Performance Evaluation\"]}]}],\"\\n\",[\"$\",\"pre\",\"pre-6\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"new LatencyScorer({\\n  maxLatencyMs: 1000, // Maximum acceptable latency\\n  penaltyThreshold: 500, // Start penalizing after this\\n});\\n\"}]}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Scoring Logic:\"}]}],\"\\n\",[\"$\",\"ul\",\"ul-1\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"Perfect score (1.0) for latency ≤ threshold\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"Linear penalty between threshold and max\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"Severe penalty (0.1) for exceeding max\"}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"children\":\"Perfect score for 0ms latency\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h4\",\"h4-6\",{\"id\":\"workflowscorer---workflow-success-evaluation\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#workflowscorer---workflow-success-evaluation\",\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"WorkflowScorer\"}]}],\" - Workflow Success Evaluation\"]}]}],\"\\n\",[\"$\",\"pre\",\"pre-7\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"new WorkflowScorer({\\n  requireSuccess: true, // Must have success: true\\n  checkMessages: true, // Validate message structure\\n  minMessages: 2, // Minimum message count\\n});\\n\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-7\",{\"id\":\"contentscorer---output-quality-assessment\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#contentscorer---output-quality-assessment\",\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"ContentScorer\"}]}],\" - Output Quality Assessment\"]}]}],\"\\n\",[\"$\",\"pre\",\"pre-8\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"new ContentScorer({\\n  exactMatch: false, // Exact content matching\\n  caseSensitive: false, // Case sensitivity\\n  patterns: [/\\\\d+/, /success/], // RegExp patterns to match\\n  requiredKeywords: [\\\"result\\\"], // Must contain these\\n  forbiddenKeywords: [\\\"error\\\", \\\"fail\\\"], // Penalize these\\n});\\n\"}]}],\"\\n\",[\"$\",\"p\",\"p-8\",{\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Multi-dimensional Scoring:\"}]}],\"\\n\",[\"$\",\"ul\",\"ul-2\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"40% pattern matching\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"40% required keywords\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"-20% forbidden keywords penalty\"}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"children\":\"20% content relevance\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",\"h3-3\",{\"id\":\"74-custom-matchers\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#74-custom-matchers\",\"children\":\"7.4 Custom Matchers\"}]}],\"\\n\",[\"$\",\"p\",\"p-9\",{\"children\":\"MCPVals extends Vitest with MCP-specific assertion matchers:\"}],\"\\n\",[\"$\",\"pre\",\"pre-9\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"// Tool call assertions\\nawait expect(result).toCallTool(\\\"add\\\");\\nawait expect(result).toCallTools([\\\"add\\\", \\\"multiply\\\"]);\\nawait expect(result).toHaveToolCallOrder([\\\"add\\\", \\\"multiply\\\"]);\\n\\n// Workflow assertions\\nawait expect(workflow).toHaveSuccessfulWorkflow();\\n\\n// Performance assertions\\nawait expect(result).toHaveLatencyBelow(1000);\\n\\n// Content assertions\\nawait expect(result).toContainKeywords([\\\"success\\\", \\\"complete\\\"]);\\nawait expect(result).toMatchPattern(/result: \\\\d+/);\\n\"}]}],\"\\n\",[\"$\",\"p\",\"p-10\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"Smart Content Extraction\"}],\": Matchers automatically handle various output formats:\"]}],\"\\n\",[\"$\",\"ul\",\"ul-3\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"MCP server responses (\",[\"$\",\"code\",\"code-0\",{\"children\":\"content[0].text\"}],\")\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"Custom result objects (\",[\"$\",\"code\",\"code-0\",{\"children\":\"{ result, toolCalls, latency }\"}],\")\"]}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"String outputs\"}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"children\":[\"Workflow results (\",[\"$\",\"code\",\"code-0\",{\"children\":\"{ success, messages, toolCalls }\"}],\")\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",\"h3-4\",{\"id\":\"75-typescript-support\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#75-typescript-support\",\"children\":\"7.5 TypeScript Support\"}]}],\"\\n\",[\"$\",\"p\",\"p-11\",{\"children\":\"Complete type safety with concrete types for common use cases:\"}],\"\\n\",[\"$\",\"pre\",\"pre-10\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"import type {\\n  MCPTestConfig,\\n  MCPTestContext,\\n  ToolCallTestCase,\\n  MCPToolResult,\\n  MCPWorkflowResult,\\n  ToolCallScorerOptions,\\n  LatencyScorerOptions,\\n  ContentScorerOptions,\\n  WorkflowScorerOptions,\\n} from \\\"mcpvals\\\";\\n\\n// Typed test case\\nconst testCase: ToolCallTestCase = {\\n  input: { operation: \\\"add\\\", a: 5, b: 3 },\\n  expected: { result: \\\"8\\\", tools: [\\\"add\\\"] },\\n};\\n\\n// Typed scorer options\\nconst scorer = new ToolCallScorer({\\n  expectedOrder: true,\\n  allowExtraTools: false,\\n} satisfies ToolCallScorerOptions);\\n\\n// Typed task function\\ntask: async (input, context): Promise\u003cMCPToolResult\u003e =\u003e {\\n  const testCase = input as ToolCallTestCase[\\\"input\\\"];\\n  const result = await context.utils.callTool(testCase.operation, {\\n    a: testCase.a,\\n    b: testCase.b,\\n  });\\n  return {\\n    result: result.content[0].text,\\n    toolCalls: [{ name: testCase.operation }],\\n    success: true,\\n    latency: Date.now() - startTime,\\n  };\\n};\\n\"}]}],\"\\n\",[\"$\",\"h3\",\"h3-5\",{\"id\":\"76-advanced-usage\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#76-advanced-usage\",\"children\":\"7.6 Advanced Usage\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-8\",{\"id\":\"dynamic-test-generation\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#dynamic-test-generation\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Dynamic Test Generation\"}]}]}],\"\\n\",[\"$\",\"pre\",\"pre-11\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"describeEval({\\n  name: \\\"Dynamic Calculator Tests\\\",\\n  data: async () =\u003e {\\n    const operations = [\\\"add\\\", \\\"subtract\\\", \\\"multiply\\\", \\\"divide\\\"];\\n    return operations.map((op) =\u003e ({\\n      name: `Test ${op}`,\\n      input: { operation: op, a: 10, b: 2 },\\n      expected: { tools: [op] },\\n    }));\\n  },\\n});\\n\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-9\",{\"id\":\"context-aware-testing\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#context-aware-testing\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Context-Aware Testing\"}]}]}],\"\\n\",[\"$\",\"pre\",\"pre-12\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"task: async (input, context) =\u003e {\\n  console.log(\\n    \\\"Available tools:\\\",\\n    context.tools.map((t) =\u003e t.name),\\n  );\\n  console.log(\\\"Running:\\\", context.testCase.name);\\n\\n  const resources = await context.utils.listResources();\\n  const prompts = await context.utils.listPrompts();\\n\\n  return await context.utils.callTool(\\\"process\\\", {\\n    ...input,\\n    resources,\\n    prompts,\\n  });\\n};\\n\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-10\",{\"id\":\"debug-mode\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#debug-mode\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Debug Mode\"}]}]}],\"\\n\",[\"$\",\"pre\",\"pre-13\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-bash\",\"children\":\"# Enable detailed logging\\nVITEST_MCP_DEBUG=true vitest run\\n\\n# Shows:\\n# - Individual test scores and explanations\\n# - Performance metrics\\n# - Pass/fail reasons\\n# - Server lifecycle events\\n\"}]}],\"\\n\",[\"$\",\"h3\",\"h3-6\",{\"id\":\"77-integration-patterns\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#77-integration-patterns\",\"children\":\"7.7 Integration Patterns\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-11\",{\"id\":\"unit-testing-individual-tools\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#unit-testing-individual-tools\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Unit Testing Individual Tools\"}]}]}],\"\\n\",[\"$\",\"pre\",\"pre-14\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"describe(\\\"Individual Tool Tests\\\", () =\u003e {\\n  beforeAll(() =\u003e setupMCPServer(config));\\n  afterAll(() =\u003e teardownMCPServer());\\n\\n  mcpTest(\\\"calculator addition\\\", async (utils) =\u003e {\\n    const result = await utils.callTool(\\\"add\\\", { a: 2, b: 3 });\\n    expect(result.content[0].text).toBe(\\\"5\\\");\\n  });\\n\\n  mcpTest(\\\"error handling\\\", async (utils) =\u003e {\\n    try {\\n      await utils.callTool(\\\"divide\\\", { a: 10, b: 0 });\\n      throw new Error(\\\"Should have failed\\\");\\n    } catch (error) {\\n      expect(error.message).toContain(\\\"division by zero\\\");\\n    }\\n  });\\n});\\n\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-12\",{\"id\":\"integration-testing-with-workflows\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#integration-testing-with-workflows\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Integration Testing with Workflows\"}]}]}],\"\\n\",[\"$\",\"pre\",\"pre-15\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"mcpTest(\\\"complex workflow\\\", async (utils) =\u003e {\\n  const workflow = await utils.runWorkflow([\\n    {\\n      user: \\\"Calculate 2+3 then multiply by 4\\\",\\n      expectTools: [\\\"add\\\", \\\"multiply\\\"],\\n    },\\n  ]);\\n\\n  await expect(workflow).toHaveSuccessfulWorkflow();\\n  await expect(workflow).toCallTools([\\\"add\\\", \\\"multiply\\\"]);\\n  expect(workflow.messages).toHaveLength(2);\\n});\\n\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-13\",{\"id\":\"performance-benchmarking\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#performance-benchmarking\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Performance Benchmarking\"}]}]}],\"\\n\",[\"$\",\"pre\",\"pre-16\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"describeEval({\\n  name: \\\"Performance Benchmarks\\\",\\n  threshold: 0.9, // High threshold for performance tests\\n  scorers: [\\n    new LatencyScorer({\\n      maxLatencyMs: 100, // Strict latency requirement\\n      penaltyThreshold: 50,\\n    }),\\n    new ToolCallScorer({ allowExtraTools: false }), // No unnecessary calls\\n    new ContentScorer({ patterns: [/^\\\\d+$/] }), // Validate output format\\n  ],\\n});\\n\"}]}],\"\\n\",[\"$\",\"h4\",\"h4-14\",{\"id\":\"multi-server-testing\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#multi-server-testing\",\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Multi-Server Testing\"}]}]}],\"\\n\",[\"$\",\"pre\",\"pre-17\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"describe(\\\"Multi-Server Comparison\\\", () =\u003e {\\n  const servers = [\\n    { name: \\\"Server A\\\", command: \\\"./server-a.js\\\" },\\n    { name: \\\"Server B\\\", command: \\\"./server-b.js\\\" },\\n  ];\\n\\n  servers.forEach((server) =\u003e {\\n    describe(server.name, () =\u003e {\\n      beforeAll(() =\u003e\\n        setupMCPServer({\\n          transport: \\\"stdio\\\",\\n          command: \\\"node\\\",\\n          args: [server.command],\\n        }),\\n      );\\n      afterAll(() =\u003e teardownMCPServer());\\n\\n      mcpTest(\\\"standard test\\\", async (utils) =\u003e {\\n        const result = await utils.callTool(\\\"test\\\", {});\\n        expect(result).toBeDefined();\\n      });\\n    });\\n  });\\n});\\n\"}]}],\"\\n\",[\"$\",\"h3\",\"h3-7\",{\"id\":\"78-best-practices\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#78-best-practices\",\"children\":\"7.8 Best Practices\"}]}],\"\\n\",[\"$\",\"ol\",\"ol-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":[\"Use \",[\"$\",\"code\",\"code-0\",{\"children\":\"beforeAll\"}],\"/\",[\"$\",\"code\",\"code-1\",{\"children\":\"afterAll\"}]]}],\": Always properly setup and teardown MCP servers\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"Leverage TypeScript\"}],\": Use concrete types for better development experience\"]}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"Test individual tools first\"}],\": Use \",[\"$\",\"code\",\"code-0\",{\"children\":\"mcpTest\"}],\" for unit testing, \",[\"$\",\"code\",\"code-1\",{\"children\":\"describeEval\"}],\" for integration\"]}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"Set appropriate thresholds\"}],\": Start with 0.8, adjust based on your quality requirements\"]}],\"\\n\",[\"$\",\"li\",\"li-4\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"Combine scorers\"}],\": Use multiple scorers to evaluate different aspects (functionality, performance, content)\"]}],\"\\n\",[\"$\",\"li\",\"li-5\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"Enable debug mode\"}],\": Use \",[\"$\",\"code\",\"code-0\",{\"children\":\"VITEST_MCP_DEBUG=true\"}],\" when troubleshooting\"]}],\"\\n\",[\"$\",\"li\",\"li-6\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"Write realistic test data\"}],\": Create test cases that reflect real-world usage\"]}],\"\\n\",[\"$\",\"li\",\"li-7\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"Use custom matchers\"}],\": Leverage MCP-specific matchers for readable assertions\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",\"h3-8\",{\"id\":\"79-example-complete-test-suite\",\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"#79-example-complete-test-suite\",\"children\":\"7.9 Example: Complete Test Suite\"}]}],\"\\n\",[\"$\",\"pre\",\"pre-18\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-typescript\",\"children\":\"$4\"}]}],\"\\n\",[\"$\",\"p\",\"p-12\",{\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"Run the tests:\"}]}],\"\\n\",[\"$\",\"pre\",\"pre-19\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"language-bash\",\"children\":\"# Run all tests\\nvitest run\\n\\n# Run with debug output\\nVITEST_MCP_DEBUG=true vitest run\\n\\n# Run in watch mode during development\\nvitest\\n\\n# Generate coverage report\\nvitest run --coverage\\n\"}]}],\"\\n\",[\"$\",\"p\",\"p-13\",{\"children\":[\"This Vitest integration makes MCP server testing \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"accessible, automated, and reliable\"}],\" - combining the speed and developer experience of Vitest with specialized tools for comprehensive MCP server evaluation.\"]}],\"\\n\",[\"$\",\"hr\",\"hr-0\",{}]]}],null],null],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"docs\",\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[null,[\"$\",\"div\",null,{\"className\":\"flex\",\"children\":[[\"$\",\"aside\",null,{\"className\":\"w-64 shrink-0 border-r border-zinc-200/60 dark:border-zinc-800/60 p-4 sticky top-0 h-screen overflow-y-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-lg font-semibold mb-4\",\"children\":\"MCPVals Docs\"}],[\"$\",\"nav\",null,{\"className\":\"space-y-1\",\"children\":[[\"$\",\"$L8\",\"/workspace/website/content/index.md\",{\"href\":\"/docs/index\",\"className\":\"block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900\",\"children\":\"Core Concepts\"}],[\"$\",\"$L8\",\"/workspace/website/content/acknowledgements.md\",{\"href\":\"/docs/acknowledgements\",\"className\":\"block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900\",\"children\":\"Acknowledgements\"}],[\"$\",\"$L8\",\"/workspace/website/content/cli.md\",{\"href\":\"/docs/cli\",\"className\":\"block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900\",\"children\":\"CLI Reference\"}],[\"$\",\"$L8\",\"/workspace/website/content/configuration.md\",{\"href\":\"/docs/configuration\",\"className\":\"block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900\",\"children\":\"Configuration\"}],[\"$\",\"$L8\",\"/workspace/website/content/evaluation.md\",{\"href\":\"/docs/evaluation\",\"className\":\"block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900\",\"children\":\"Evaluation \u0026 Metrics\"}],[\"$\",\"$L8\",\"/workspace/website/content/installation.md\",{\"href\":\"/docs/installation\",\"className\":\"block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900\",\"children\":\"Installation \u0026 Runtime Requirements\"}],[\"$\",\"$L8\",\"/workspace/website/content/library-api.md\",{\"href\":\"/docs/library-api\",\"className\":\"block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900\",\"children\":\"Library API\"}],[\"$\",\"$L8\",\"/workspace/website/content/quick-start.md\",{\"href\":\"/docs/quick-start\",\"className\":\"block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900\",\"children\":\"Quick Start\"}],[\"$\",\"$L8\",\"/workspace/website/content/roadmap.md\",{\"href\":\"/docs/roadmap\",\"className\":\"block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900\",\"children\":\"Roadmap\"}],[\"$\",\"$L8\",\"/workspace/website/content/vitest.md\",{\"href\":\"/docs/vitest\",\"className\":\"block rounded px-2 py-1 hover:bg-zinc-100 dark:hover:bg-zinc-900\",\"children\":\"Vitest Integration\"}]]}]]}],[\"$\",\"main\",null,{\"className\":\"flex-1 p-6\",\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"docs\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]}]]}]],null],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f25260a5bd2b21c3.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"min-h-screen bg-white text-zinc-900 antialiased dark:bg-zinc-950 dark:text-zinc-100\",\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$L9\"],\"globalErrorComponent\":\"$a\",\"missingSlots\":\"$Wb\"}]\n"])</script><script>self.__next_f.push([1,"9:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"MCPVals Docs\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Documentation for MCPVals\"}]]\n3:null\n"])</script></body></html>